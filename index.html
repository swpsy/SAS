<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>焦虑自测量表 — 识我心理 SoulWeave</title>
<style>
:root{
  --bg:#f7fafc;
  --card:#fff;
  --green:#16a34a;
  --muted:#666;
}

*{box-sizing:border-box;font-family:"Noto Sans SC","Microsoft Yahei",Arial,sans-serif}
body{margin:0;background:var(--bg);color:#111}
.container{max-width:760px;margin:36px auto;padding:20px}
.card{background:var(--card);border-radius:12px;padding:28px;box-shadow:0 6px 18px rgba(20,20,30,0.06)}

.notice{font-size:16px;line-height:1.8}
.notice b{font-weight:800}
.darkred{color:#8b0000}
.start-btn{display:block;margin:28px auto 0;padding:12px 22px;background:var(--green);color:#fff;border-radius:8px;border:none;font-size:18px;cursor:pointer}

.q-title{font-size:20px;margin-bottom:16px}
.choices{display:flex;flex-direction:column;gap:12px}
.choice{padding:14px;border-radius:10px;border:1px solid #e6e6e6;cursor:pointer}
.choice:hover{background:#f1f6ff}
.nav-buttons{margin-top:18px;display:flex;justify-content:space-between}
.nav-btn{padding:8px 16px;background:#eee;border-radius:6px;border:none;cursor:pointer}
.nav-btn:hover{background:#ddd}
.logo-small{font-size:12px;color:var(--muted);text-align:center;margin-top:18px}

.prog{height:8px;background:#eee;border-radius:8px;overflow:hidden;margin:16px 0}
.prog > i{display:block;height:100%;background:linear-gradient(90deg,#60a5fa,#7c3aed);width:0%}

.report-score{font-size:28px;font-weight:700;margin-bottom:8px}
.score-sub{color:var(--muted);margin-bottom:12px}
.bar-container{position:relative;margin-top:20px;margin-bottom:40px;}
.bar-wrap{position:relative;height:16px;background:linear-gradient(90deg,#60a5fa,#7c3aed);border-radius:8px}
.marker{position:absolute;top:-12px;width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-top:12px solid #111;transform:translateX(-50%)}

.threshold-labels{
  position:relative;
  display:flex;
  justify-content:space-between;
  margin-top:8px;
  font-size:12px;
  color:#000;
}

.legend{margin-top:12px;font-size:16px;line-height:1.5em;min-height:3em}
.desc{margin-top:12px;background:#fbfbfe;padding:14px;border-radius:8px;border:1px solid #eee;min-height:6em}

.download-btn,.restart-btn{
  display:inline-block;
  margin-top:18px;
  padding:10px 16px;
  background:#111;
  color:#fff;
  border-radius:8px;
  text-decoration:none;
}
.restart-btn{background:#16a34a;margin-left:8px}
.notes{font-size:12px;color:#555;margin-top:18px}

.screen{display:none}
.screen.active{display:block}
footer{margin-top:18px;text-align:center;color:var(--muted);font-size:12px}

@media (max-width:520px){.container{padding:14px}.card{padding:18px}}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <!-- Start Screen -->
    <section id="start" class="screen active">
      <h2>焦虑自测量表</h2>
      <p class="notice"><b>注意事项：</b><br>
        本测试仅供参考，不作指导意见。本测试主要用于疗效评估，不能用于诊断<br>
        请根据 <span class="darkred"><b>过去一周</b></span> 的情况填写题目。
      </p>
      <input type="password" id="testPassword" placeholder="请输入测评密码" style="width:100%;padding:8px;margin-top:10px;border-radius:6px;border:1px solid #ccc;">
      <div id="errorMsg" style="color:red;margin-top:6px;font-size:14px"></div>
      <button id="btnStart" class="start-btn">开始测评</button>
    </section>

    <!-- Question Screen -->
    <section id="question-area" class="screen">
      <div class="prog"><i id="progbar"></i></div>
      <div class="q-title" id="qtext">题目文本</div>
      <div class="choices" id="choices"></div>
      <div class="nav-buttons">
        <button id="prevBtn" class="nav-btn">上一题</button>
        <span id="qNumDisplay"></span>
      </div>
      <div class="logo-small">识我心理 SoulWeave</div>
    </section>

    <!-- Report Screen -->
    <section id="report" class="screen">
      <h2>测评报告</h2>
      <div id="report-content">
        <div class="report-score" id="stdscore">标准分：--</div>
        <div class="score-sub" id="rawscore">原始分：-- &nbsp;（标准分 = 原始分 × 1.25）</div>

        <div class="bar-container">
          <div class="bar-wrap" id="gradbar">
            <div id="marker" class="marker"></div>
          </div>
          <div class="threshold-labels">
            <span>正常</span>
            <span>轻度焦虑</span>
            <span>中度焦虑</span>
            <span>重度焦虑</span>
          </div>
        </div>

        <div class="legend" id="categoryLabel">-</div>
        <div class="desc" id="categoryDesc">-</div>

        <div>
          <a id="downloadPdf" class="download-btn" href="#">下载 PDF 报告</a>
          <a id="restartTest" class="restart-btn" href="#">重新测试</a>
        </div>

        <div class="notes">
          注：量表得分超过60分，建议立即前往医院获取专业评估<br>
          注：量表结果仅供测试者参考，具体请以医院专业心理/精神科的评定
        </div>
      </div>
    </section>
  </div>
  <footer>版本：识我心理 SoulWeave — 焦虑自测</footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const questions=[{q:'1．我觉得比平时容易紧张和着急'},{q:'2．我无缘无故地感到害怕'},{q:'3．我容易心里烦乱或觉得惊恐'},{q:'4．我觉得我可能将要发疯'},{q:'5．我觉得一切都很好，也不会发生什么不幸'},{q:'6．我手脚发抖打颤'},{q:'7．我因为头痛、颈痛和背痛而苦恼'},{q:'8．我感觉容易衰弱和疲乏 '},{q:'9．我觉得心平气和，并且容易安静坐着'},{q:'10．我觉得心跳得快'},{q:'11．我因为一阵阵头晕而苦恼'},{q:'12．我有过晕倒发作，或觉得要晕倒似的'},{q:'13．我呼气吸气都感到很容易'},{q:'14．我手脚麻木和刺痛'},{q:'15．我因胃痛和消化不良而苦恼'},{q:'16．我常常要小便'},{q:'17．我的手常常是干燥温暖的'},{q:'18．我脸红发热'},{q:'19．我容易入睡并且一夜睡得很好'},{q:'20．我做恶梦'}];
const reverseItems=new Set([5,9,13,17,19]);
const options=['没有或很少时间','小部分时间','相当多时间','绝大部分或全部时间'];

let idx=0;
let rawScores=Array(questions.length).fill(0);

const startBtn=document.getElementById('btnStart');
const startScreen=document.getElementById('start');
const qArea=document.getElementById('question-area');
const report=document.getElementById('report');
const qtext=document.getElementById('qtext');
const choices=document.getElementById('choices');
const progbar=document.getElementById('progbar');
const marker=document.getElementById('marker');
const errorMsg=document.getElementById('errorMsg');
const prevBtn=document.getElementById('prevBtn');
const qNumDisplay=document.getElementById('qNumDisplay');

startBtn.addEventListener('click',()=>{
  const pwd=document.getElementById('testPassword').value.trim();
  if(pwd==='9910'){
    errorMsg.textContent='';
    startScreen.classList.remove('active');
    qArea.classList.add('active');
    idx=0;
    rawScores.fill(0);
    renderQuestion();
  } else {
    errorMsg.textContent='密码失效，请联系客服';
  }
});

function renderQuestion(){
  const qobj=questions[idx];
  qtext.textContent=qobj.q;
  choices.innerHTML='';
  options.forEach((opt,i)=>{
    const div=document.createElement('div');
    div.className='choice';
    div.textContent=opt;
    div.onclick=()=>selectOption(i+1);

    // 高亮当前选项
    if(rawScores[idx]>0){
      let displayVal=rawScores[idx];
      let highlightIndex=reverseItems.has(idx+1)?5-displayVal:displayVal;
      if(i+1===highlightIndex){div.style.background="#d0ebff";}
    }

    choices.appendChild(div);
  });
  progbar.style.width=Math.round((idx)/questions.length*100)+'%';
  qNumDisplay.textContent=`第 ${idx+1}/${questions.length} 题`;
  prevBtn.style.display=idx>0?'inline-block':'none';
  window.scrollTo({top:0,behavior:'smooth'});
}

function selectOption(choiceValue){
  let val=choiceValue;
  if(reverseItems.has(idx+1)) val=5-choiceValue;
  rawScores[idx]=val;
  if(idx<questions.length-1){idx++;renderQuestion();}else{showReport();}
}

prevBtn.addEventListener('click',()=>{if(idx>0){idx--;renderQuestion();}});

function showReport(){
  qArea.classList.remove('active');
  report.classList.add('active');

  const rawTotal=rawScores.reduce((a,b)=>a+b,0);
  const stdScore=+(rawTotal*1.25).toFixed(1);
  document.getElementById('rawscore').textContent=`原始分：${rawTotal} （标准分 = 原始分 × 1.25）`;
  document.getElementById('stdscore').textContent=`标准分：${stdScore}`;

  const min=25,max=100;
  let pct=((stdScore-min)/(max-min))*100;
  pct=Math.max(0,Math.min(100,pct));
  marker.style.left=pct+'%';

  let cat='',content='';
  if (stdScore <= 50) {
    cat = '正常';
    content = `...<p><strong style="color:#007BFF;">解释：</strong><br>
    您的分数在大多数人的常规波动范围内。这表明在过去的一周里，您可能像大多数人一样，虽然会遇到一些让人紧张或担心的事情，但这些情绪是暂时的、情境性的，并没有持续地困扰您，也没有对您的生活、工作和社交造成明显的干扰。这就像一个湖面，偶尔有风吹过会有涟漪，但大部分时间是平静的。</p>
    <p><strong style="color:#007BFF;">建议：</strong><br>
    这是一个积极的信号，说明您有比较好的内在平衡能力。可以借此机会学习如何‘维稳’和提升心理免疫力,建立健康的压力应对机制，例如：<br>
    规律生活：保持稳定的作息和充足的睡眠，这是情绪的基石。<br>
    身体活动：每周3-5次，每次30分钟的中等强度运动（如快走、慢跑、瑜伽）对缓解压力非常有效。<br>
    正念练习：每天尝试5-10分钟的深呼吸或正念冥想，专注于当下，不加评判地观察自己的感受。<br>
    兴趣滋养：刻意留出时间给自己，投入到能带来快乐和成就感的兴趣爱好中。<br>
    关注信号：虽然目前状态不错，但可以留意哪些事情容易引发您的焦虑，提前做好准备，这就是很好的自我关怀。
    </p>...`;
  } else if (stdScore >= 50 && stdScore <= 59) {
    cat = '轻度焦虑';
    content = `...<p><strong style="color:#007BFF;">解释：</strong><br>
    您的分数显示，您近期确实感受到比平常更多的焦虑和担忧。可能会觉得心里总是有事放不下，容易疲倦，或者身体上有些紧张，比如肩颈发硬、睡眠较浅等。这些感觉就像身边一直有一个‘背景噪音’，虽然还能继续工作生活，但需要耗费比平时更多的精力去忽略它，会让人感到有些辛苦。</p>
    <p><strong style="color:#007BFF;">建议：</strong><br>
    请理解这是一种非常常见的状态，很多人都会经历。这不是你的错，而是你在应对压力时身体和大脑发出的信号。<br>
    情绪日记：建议记录“焦虑日记”，写下：<br>
    1）什么事件引发了焦虑？<br>
    2）当时的具体想法是什么？<br>
    3）身体有什么感觉？<br>
    4）做了什么？<br>
    这些能帮助您发现焦虑的原因。
    放松训练：学习腹式呼吸法（吸气时肚子鼓起，呼气时肚子收回）或渐进式肌肉放松法（先紧绷再放松全身各个肌肉群），在感到紧张时立即使用。<br>
    挑战想法：练习问自己：“我担心的这个事，最坏的结果有多大可能发生？如果发生了，我真的无法应对吗？有没有其他更积极的可能性？”<br>
    主动与值得信赖的家人、朋友倾诉你的感受。“说出来”本身就有疗愈作用。<br>
    如果这些方法尝试2-4周后，感觉变化不大，或者焦虑影响了您的效率，考虑预约一次正式的心理咨询会非常有帮助。心理咨询师将和您一起更系统地探索和应对。</p>
    <p><strong style="color:#007BFF;">*作者想说*</strong><br>
    你不需要完美地应对焦虑，能停下来照顾自己，就是在向前走。
    </p>...`;
  } else if (stdScore >= 60 && stdScore < 69) {
    cat = '中度焦虑';
    content = `...<p><strong style="color:#007BFF;">解释：</strong><br>
    您的分数表明，焦虑情绪已经达到了一个需要高度重视的程度。它可能不再只是一个‘背景噪音’，而更像一个经常响起的‘警报’，频繁地打断您的思绪，让您难以放松和专注。您可能会感到心慌、手抖、呼吸急促，睡眠和食欲也可能受到明显影响。在这种情况下，感觉工作和生活变得‘很吃力’是非常真实的，这些情况确实消耗了大量的心理能量。</p>
    <p><strong style="color:#007BFF;">建议：</strong><br>
    在这个水平上，焦虑本身可能会形成一个‘越焦虑，越难克服’的循环。强烈建议您考虑寻求专业帮助。这就像感冒发烧了需要吃药，心理上的困扰也有非常有效的方法可以应对。<br>
    心理咨询：寻找一位专业的心理咨询师/治疗师。认知行为疗法被证实对焦虑问题非常有效，它能帮你识别并改变导致焦虑的思维和行为模式。<br>
    精神科就诊：可以去综合医院的精神科（或心理卫生科）进行专业评估。医生可能会根据情况判断是否需要短期药物来快速稳定剧烈的情绪和身体症状，为心理治疗创造空间。药物并不可怕，它是帮助您稳定下来的有力工具。<br>
    降低自我要求：允许自己“做不到那么好”，暂时降低工作和生活的标准。<br>
    保证休息：即使睡不着，也要安排时间躺下休息。<br>
    避免刺激：减少咖啡、浓茶和酒精的摄入。</p>
    <p><strong style="color:#007BFF;">*作者想说*</strong><br>
    你不需要马上“摆脱焦虑”，你只需要在它出现时，先对自己温柔一点。<br>
    世界不会因为你慢下来而崩塌，相反，它会等你。
    </p>...`;
  } else if (stdScore >= 69) {
    cat = '重度焦虑';
    content = `...<p><strong style="color:#007BFF;">解释：</strong><br>
    您的分数表明，您目前正承受着非常高强度的焦虑和痛苦。这种情绪已经非常强烈，你可能感觉到无法思考任何事情。身体可能会持续出现强烈不适，睡眠和饮食严重紊乱。在这种情况下，维持日常的基本功能都会变得极其困难。请知道，您感到如此痛苦，不是因为您脆弱，而是因为焦虑的水平已经超出了个人能轻易调节的范围。</p>
    <p><strong style="color:#007BFF;">建议：</strong><br>
    现在最重要、最紧急的一步，是获得专业的支持。这不再是‘可以考虑’，而是‘非常必要’。您不需要独自承受这一切。<br>
    首选路径：尽快去综合医院的精神科或心理卫生中心就诊。这是最直接、最安全的方式。精神科医生能够进行权威诊断，并评估是否需要药物来快速缓解您极度的痛苦。<br>
    心理治疗：药物治疗可以帮助您从情绪的深渊中上来，而长期的心理治疗则能帮助您重建内心的平静，处理导致焦虑的深层根源。两者结合通常是应对重度焦虑的最佳方案。<br>
    告知亲友：请立即告诉一位您信任的亲人或朋友您现在的状况，请他们陪同您就医或给予您支持。<br>
    危机热线：如果您感到极度无助或有伤害自己的念头，请立即拨打危机干预热线，他们24小时有人接听。<br>
    无论您现在的分数是多少，重要的是您已经迈出了觉察的第一步。焦虑是可以被有效治疗的。寻求帮助是强者和关爱自己的表现。您并不孤单，有很多资源和支持等着您。</p>
    <p><strong style="color:#007BFF;">*作者想说*</strong><br>
    你不必独自面对一切。<br>
    北京24小时免费心理危机咨询热线：010-8295-1332
    </p>...`;
  }

  // ✅ 修正这里的显示
  document.getElementById('categoryLabel').textContent = `评估结果：${cat}`;
  document.getElementById('categoryDesc').innerHTML = content;
}

// PDF 导出
async function downloadPDF(){
  const el=document.getElementById('report-content');
  const canvas=await html2canvas(el,{scale:2,useCORS:true,backgroundColor:'#ffffff'});
  const imgData=canvas.toDataURL('image/png');
  const { jsPDF }=window.jspdf;
  const pdf=new jsPDF({orientation:'portrait',unit:'px',format:[canvas.width,canvas.height]});
  pdf.addImage(imgData,'PNG',0,0,canvas.width,canvas.height);
  pdf.save('SAS_report.pdf');
}

document.getElementById('downloadPdf').onclick=function(e){e.preventDefault();downloadPDF();};

// ✅ 重新测试功能
document.getElementById('restartTest').addEventListener('click', (e)=>{
  e.preventDefault();
  rawScores.fill(0);
  idx=0;
  report.classList.remove('active');
  qArea.classList.add('active');
  renderQuestion();
});

document.addEventListener('keydown',(e)=>{
  if(qArea.classList.contains('active')){
    if(e.key>='1'&&e.key<='4') selectOption(parseInt(e.key));
  }
});
</script>
</body>
</html>
